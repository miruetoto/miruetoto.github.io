---
title: ubuntu 에서 R 및 Python 개발환경 만들기
layout: post 
---

### About this doc

- 이번에는 우분투컴퓨터를 통하여 개발환경을 설정하는 방법에 대하여 알아보겠습니다. 

- 우분투에서 프로그래밍 작업을 해야하는 이유는 파이썬을 기반으로 하는 여러가지 개발환경을 구축하는 것이 윈도우나 맥보다 우분투에서 최적화 되어있기 때문입니다. 따라서 R만 활용하실 경우라면 윈도우나 맥을 사용해도 충분하지만 R과 파이썬을 동시에 사용하는 경우라면 우분투에서 작업하는 것이 좋습니다. 

- 기본적으로 (1) 파이썬을 활용하기에 유리한 IDE인 주피터노트북(혹은 주피터랩)을 설치하는 방법 (2) R을 활용하기에 유리한 IDE인 Rstudio를 설치하는 방법 (3) (1)-(2)를 네트워크로 연결하여 브라우저에서 작업하도록 하는 방법을 알아보겠습니다.

### 우분투 설치 및 R,Python 개발환경 구축 

***한글설정***

- 아래와 같이 커맨드에 친다. <br/><br/>
```
ibus-setup
```
이걸 치면 IBus Preferences 라는 창이 나오는데 여기에서 (1) Input Method 탭 클릭 (2) Add 버튼 클릭 (3) Korean 선택 (4) Hangul 선택을 한다. 

- 위의 단계에서 Korean이 안보이면 Language Support로 가서 한국어팩을 설치하고 리부팅 하면 된다. (보통 Language Support로 가자마자 알아서 설치됨. 설치가 안되면 Install / Remove Languages... 이라는 탭을 클릭해서 설치한다.) 리부팅을 꼭 해야한다는 것에 주의하자. 

- 이제 Region & Language로 가서 설정하면 된다. 

***아나콘다***

- 아나콘다를 다운받은 폴더로 가서 아래와 같이 실행한다. <br/><br/>
```
bash Anaconda3-2019.03-Linux-x86_64.sh
```
대충 bash Ana 정도까지만 치고 tab을 누르면 알아서 완성된다. 

- 커맨드를 키고  아래를 실행한다. <br/><br/>
```
conda create -n py20190129
conda create -name py20190129
```
둘 중 아무거나 실행해도 된다. 환경을 만들때 파이썬버전을 3.7.6으로 통일하자. 
```
conda create -n py20190129 python=3.7.6
conda create -name py20190129 python=3.7.6
```

***주피터 원격제어***

- 콘다 가상환경에서 주피터랩을 설치한다. <br/><br/>
```
conda activate py20190129
conda install jupyterlab
```
.

- 주피터랩은 보통 로칼로 접속하는데 이를 원격으로 접속할 수 있게 만들어보자. 우선 커맨드에서 아래를 실행하자. <br/><br/>
```
conda activate py20190129
jupyter notebook --generate-config
```
이렇게 하면 /home/cgb/.jupyter 디렉토리에 jupyter_notebook_config.py 파일이 만들어진다. 나중에 이 파일에 접근해서 뭔가를 바꿔야하는데 우선 그전에 파이썬을 실행하자. 

- 콘다 가상환경에서 파이썬을 실행하고 아래를 실행한다.  <br/><br/>
```python
from notebook.auth import passwd
passwd()
```
패스워드를 설정하고 나오는 'sha1:어쩌고..' 부분을 복사한다. 


- 이제 처음에 생성한 /home/cgb/.jupyter/jupyter_notebook_config.py 파일을 연다. 
이 파일에 접근하기 위해서는 아래의 순서를 따른다. (1) 파일관리자를 키고 홈탭을 누른다. (이러면 자동으로 /home/cgb 폴더로 접근함.) (2) 컨트롤+h를 누른다. (여기에서 .jupyter 는 숨겨진 폴더라서 바로는 안보이고 컨트롤+h를 눌러야 보인다.) (3) jupyter_notebook_config.py 를 더블클릭한다. 또는 그냥 단순히 아래를 실행한다. <br/><br/>
```
sudo nano ~/.jupyter/jupyter_notebook_config.py
```
.

- 원하는대로 수정하면 되는데 아래는 꼭 수정한다. <br/><br/>
```python
c.NotebookApp.ip = '192.168.0.4'
c.NotebookApp.password = 'sha1:1969b198e067:915d665111e284538ffe3e63d08de9a0a4dba5e7'
```
여기에서 192.168.0.4 는 내부아이피다. 즉 ifconfig로 확인할 수 있는걸 쓴다. 위와 같이 수정하면 크롬등 브라우저를 실행한뒤에 192.168.0.4:8888로 접속하면 주피터노트북을 사용할 수 있다.

***주피터에 R커널 연결*** 
- 콘다환경으로 가서 아래를 실행한다. <br/><br/>
```
conda activate py20190129
conda install -c r r
```
이러면 콘다환경에는 R이 깔리고 base에는 R이 깔리지 않는다.

- 콘다환경에서 R을 실행한다. Rstudio가 아니라 커맨드에서 R을 실행해야한다. 그리고 devtools와 IRkernel을 설치한다. (devtools도 꼭 설치해야하는가?) <br/><br/>
```r
install.packages("devtools")
install.packages("IRkernel")
```
그리고 아래를 실행하면 주피터랩과 R환경이 연결된다. 
```r
IRkernel::installspec()
```
이제 주피터랩에서 R kernel을 사용할 수 있다. 

***Rstudio server***
- 이제 Rstudio server를 설치한다. 이건 콘다환경의 R과 연결이 안된다. (내가 알기론 그렇다.) 그래서 보통은 (base)에 R을 깔고 그 R과 연결해야한다. 하지만 우분투 18.04는 base에서 R을 깔기 위해서 아래와 같이 실행하면 기본적으로 R이 3.4버전으로 깔린다. <br/><br/>
```
sudo apt install r-base ## 이걸 실행하지 말자. 
```
그러니까 위와 같이 실행하지 말자. (base)에 높은 버전의 R을 억지로 까는 방법이 있긴 있다. 추천하는 방법은 아니다. 대신 콘다환경 (py20190129)에서 가서 억지로 Rstudio를 연결하는 방법을 알아보자. 관련내용은 [여기](https://github.com/grst/rstudio-server-conda)를 참고했다. 

- 먼저 Rstudio를 깐다. Rstudio server 를 설치하기 위해서는 아래를 순서대로 실행하면 된다. [여기](https://rstudio.com/products/rstudio/download-server/debian-ubuntu/)에 나온 내용을 참고하여 정리하였다. <br/><br/>
```
sudo apt-get install gdebi-core
wget https://download2.rstudio.org/server/bionic/amd64/rstudio-server-1.2.5033-amd64.deb
sudo gdebi rstudio-server-1.2.5033-amd64.deb
```
보통 여기까지하면 Rstudio 설치가 끝난다. 

- 아래를 실행한다. <br/><br/>
```
sudo apt install uuid
sudo apt install git
git clone https://github.com/grst/rstudio-server-conda.git
```
위에 두줄은 [이사람](https://github.com/grst/rstudio-server-conda)이 만든 어떤 프로그램을 쓰기 위한 사전준비작업이다. 마지막줄을 실행하면 [이사람](https://github.com/grst/rstudio-server-conda)이 만든 프로그램이 다운받아진다. 이게 프로그램 설치가 완료된것이다. 이제 컴퓨터 껐다 킬때마다 아래를 실행한다. 
```
conda activate py20190129
~/rstudio-server-conda/start_rstudio_server.sh 8787 # use any free port number here. 
```
이제 192.168.0.4:8787 따위의 주소로 접속하면 Rstudio를 쓸 수 있다. 

***rpy2***
- 콘다환경에서 아래와 같이 입력하여 설치했다. <br/><br/>
```
conda activate py20190129
pip install rpy2
```
절대로 conda install rpy2로 설치하지말자. 기본적으로 낮은버전 rpy2가 설치되는데 낮은 버전의 rpy2를 설치하면 많은 기능이 제약되어 pip로 인스톨한다. 

### 마무리하며

- rpy2를 잘 활용하면 R과 Python간의 데이터를 매우 쉽게 이동시킬 수 있습니다. 
- github를 통하여 코드를 관리하는 방법을 배운다면 매우 유용하니 시간이 여유있으시면 익혀두시기 바랍니다. 
- 주피터나 Rstudio를 원격접속가능하게 한다면 핸드폰이나 아이패드로도 컴퓨터의 성능으로 코딩이 가능합니다. 제가 강의중간에 아이패드에서 주피터나 Rstudio를 띄워서 촬영한 적이 종종 있는데 모두 이 기능을 활용한 것입니다. 
- 포트포워드를 사용하면 외부망으로 내부의 컴퓨터를 사용할 수 있습니다. 이를 활용하면 지하철에서 이동하다가 핸드폰 등을 활용하여 언제든 제 컴퓨터의 주피터나 Rstudio에 접속할 수 있습니다. 코딩을 하진 못하여도 (할수는 있는데 키보드가 불편해서..) 제가 돌려놓은 코드가 얼마나 진행되었는지 확인하기에 용이합니다. 
- 한 학기동안 고생 많으셨습니다. 제가 욕심이 많아 너무 이것저것 전달하려고 하다보니 공부하시기 힘들으셨을텐데 잘 따라워주셔서 감사합니다. 우수한 학생들을 지도할 수 있어서 개인적으로 큰 자부심을 느낍니다. 